<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Extending Logging System | Grapheteria</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Extending Logging System" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Cooking up agentic workflows!" /> <meta property="og:description" content="Cooking up agentic workflows!" /> <link rel="canonical" href="http://localhost:4000/Advanced/Extending_Logging.html" /> <meta property="og:url" content="http://localhost:4000/Advanced/Extending_Logging.html" /> <meta property="og:site_name" content="Grapheteria" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Extending Logging System" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Cooking up agentic workflows!","headline":"Extending Logging System","url":"http://localhost:4000/Advanced/Extending_Logging.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Grapheteria </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Core/" class="nav-list-link">Core</a><ul class="nav-list"><li class="nav-list-item"><a href="/Core/Node.html" class="nav-list-link">Node</a></li><li class="nav-list-item"><a href="/Core/Edge.html" class="nav-list-link">Edge</a></li><li class="nav-list-item"><a href="/Core/Shared.html" class="nav-list-link">Communication</a></li><li class="nav-list-item"><a href="/Core/Workflow.html" class="nav-list-link">Workflow Engine</a></li><li class="nav-list-item"><a href="/Core/Logging.html" class="nav-list-link">Logging</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in UI category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Core/UI/" class="nav-list-link">UI</a><ul class="nav-list"><li class="nav-list-item"><a href="/Core/UI/Overview.html" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="/Core/UI/Debug.html" class="nav-list-link">Debug Mode</a></li><li class="nav-list-item"><a href="/Core/UI/Logs.html" class="nav-list-link">Logs Page</a></li><li class="nav-list-item"><a href="/Core/UI/Troubleshooting.html" class="nav-list-link">Troubleshooting</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Advanced/" class="nav-list-link">Advanced</a><ul class="nav-list"><li class="nav-list-item"><a href="/Advanced/Advanced_Nodes.html" class="nav-list-link">Advanced Nodes</a></li><li class="nav-list-item"><a href="/Advanced/Extending_Logging.html" class="nav-list-link">Extending Logging System</a></li><li class="nav-list-item"><a href="/Advanced/Human_in_the_loop.html" class="nav-list-link">Human-in-the-Loop</a></li><li class="nav-list-item"><a href="/Advanced/Deployment.html" class="nav-list-link">Deploying Workflows</a></li><li class="nav-list-item"><a href="/Advanced/Event_Driven.html" class="nav-list-link">Event-Driven Workflows</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Concepts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Concepts/" class="nav-list-link">Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/Concepts/state_machines.html" class="nav-list-link">State Machines</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Grapheteria" aria-label="Search Grapheteria" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/grapheteria/grapheteria" class="site-button" target="_blank" rel="noopener noreferrer" > View GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/Advanced/">Advanced</a></li> <li class="breadcrumb-nav-list-item"><span>Extending Logging System</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="extending-the-logging-system">Extending the Logging System</h1> <h2 id="where-do-your-workflows-go-when-they-sleep">Where Do Your Workflows Go When They Sleep?</h2> <p>By default, Grapheteria stores all your workflow logs in the local filesystem. This works great for development, but when you’re ready for the big leagues (aka production), you might want something more robust. Maybe you need centralized storage, better querying capabilities, or just don’t trust those pesky local files (we’ve all accidentally <code class="language-plaintext highlighter-rouge">rm -rf</code>‘d something important, right?).</p> <h2 id="tracking-data-the-memory-of-your-workflows">Tracking Data: The Memory of Your Workflows</h2> <p>Every workflow maintains a <code class="language-plaintext highlighter-rouge">tracking_data</code> structure that contains:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="sh">"</span><span class="s">workflow_id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">your.awesome.workflow</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">run_id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">20230415_120523_123</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">steps</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># State snapshot after each step execution
</span>        <span class="c1"># Each containing everything needed to resume execution
</span>    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">steps</code> list is particularly magical - it captures the complete execution state after each node runs. This is what enables our workflow to pick up exactly where it left off, even if your server decided to take an unplanned vacation.</p> <blockquote class="important"> <p>At the end of every step, the workflow engine calls <code class="language-plaintext highlighter-rouge">self.storage.save_state()</code> with the storage object being whatever custom backend you decide to provide (defaults to local file system)</p> </blockquote> <h2 id="creating-your-own-storage-backend">Creating Your Own Storage Backend</h2> <p>The <code class="language-plaintext highlighter-rouge">StorageBackend</code> abstract class defines the interface any storage implementation must follow:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StorageBackend</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tracking_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Save the workflow execution state.</span><span class="sh">"""</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">Load a workflow execution state.</span><span class="sh">"""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">list_runs</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">List all runs for a given workflow.</span><span class="sh">"""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">list_workflows</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">List all workflows.</span><span class="sh">"""</span>
        <span class="k">pass</span>
</code></pre></div></div> <p>Let’s break down these methods:</p> <ul> <li><code class="language-plaintext highlighter-rouge">save_state</code>: Stores the workflow state with its unique identifiers</li> <li><code class="language-plaintext highlighter-rouge">load_state</code>: Retrieves the state of a specific workflow run</li> <li><code class="language-plaintext highlighter-rouge">list_runs</code>: Gets all runs for a specific workflow (useful for history/debugging)</li> <li><code class="language-plaintext highlighter-rouge">list_workflows</code>: Lists all available workflows in the storage</li> </ul> <h2 id="example-sqlite-storage-implementation">Example: SQLite Storage Implementation</h2> <p>Here’s an example of implementing SQLite storage - observe how it satisfies the same interface:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">grapheteria.utils</span> <span class="kn">import</span> <span class="n">StorageBackend</span>

<span class="k">class</span> <span class="nc">SQLiteStorage</span><span class="p">(</span><span class="n">StorageBackend</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">workflows.db</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">db_path</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_init_db</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_init_db</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># Creates the database table if it doesn't exist
</span>        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">'''</span><span class="s">
            CREATE TABLE IF NOT EXISTS workflow_states (
                workflow_id TEXT,
                run_id TEXT,
                state_json TEXT,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                PRIMARY KEY (workflow_id, run_id)
            )
            </span><span class="sh">'''</span><span class="p">)</span>
            <span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
    
    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">_get_connection</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">conn</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">conn</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Saves workflow state as JSON in the database
</span>        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span>
                <span class="sh">'''</span><span class="s">
                INSERT OR REPLACE INTO workflow_states (workflow_id, run_id, state_json, updated_at)
                VALUES (?, ?, ?, CURRENT_TIMESTAMP)
                </span><span class="sh">'''</span><span class="p">,</span>
                <span class="p">(</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">source_data</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="c1"># Retrieves workflow state from the database
</span>        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">SELECT state_json FROM workflow_states WHERE workflow_id = ? AND run_id = ?</span><span class="sh">"</span><span class="p">,</span>
                <span class="p">(</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
            
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div> <p>Using the SQLite backend is as simple as:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Initialize the workflow engine with SQLite storage
</span><span class="n">storage</span> <span class="o">=</span> <span class="nc">SQLiteStorage</span><span class="p">(</span><span class="sh">"</span><span class="s">production.db</span><span class="sh">"</span><span class="p">)</span>
<span class="n">engine</span> <span class="o">=</span> <span class="nc">WorkflowEngine</span><span class="p">(</span>
    <span class="n">workflow_id</span><span class="o">=</span><span class="sh">"</span><span class="s">my.workflow</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">storage_backend</span><span class="o">=</span><span class="n">storage</span>
<span class="p">)</span>

<span class="c1"># Now all state is stored in SQLite!
</span></code></pre></div></div> <h2 id="creating-your-own-storage">Creating Your Own Storage</h2> <p>Want to store workflows in Redis, MongoDB, or your secret underground bunker’s mainframe? Just implement those four methods and you’re good to go!</p> <p>Here’s a stub for your next storage adventure:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyAwesomeStorage</span><span class="p">(</span><span class="n">StorageBackend</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">):</span>
        <span class="c1"># Connect to your storage service
</span>        <span class="n">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="nc">AwesomeStorageClient</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">source_data</span><span class="p">):</span>
        <span class="c1"># Your code to save state
</span>        <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">upsert_document</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="sh">"</span><span class="s">workflows</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">workflow_id</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">source_data</span>
        <span class="p">)</span>
    
    <span class="c1"># Implement the other required methods...
</span></code></pre></div></div> <p>Now your workflows can live wherever they want - give them the freedom they deserve!</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
