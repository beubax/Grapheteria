<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(3)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(3) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(3) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Human-in-the-Loop | Grapheteria</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Human-in-the-Loop" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Cooking up agentic workflows!" /> <meta property="og:description" content="Cooking up agentic workflows!" /> <link rel="canonical" href="http://localhost:4000/Advanced/Human_in_the_loop.html" /> <meta property="og:url" content="http://localhost:4000/Advanced/Human_in_the_loop.html" /> <meta property="og:site_name" content="Grapheteria" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Human-in-the-Loop" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Cooking up agentic workflows!","headline":"Human-in-the-Loop","url":"http://localhost:4000/Advanced/Human_in_the_loop.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Grapheteria </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Core/" class="nav-list-link">Core</a><ul class="nav-list"><li class="nav-list-item"><a href="/Core/Node.html" class="nav-list-link">Node</a></li><li class="nav-list-item"><a href="/Core/Edge.html" class="nav-list-link">Edge</a></li><li class="nav-list-item"><a href="/Core/Shared.html" class="nav-list-link">Communication</a></li><li class="nav-list-item"><a href="/Core/Workflow.html" class="nav-list-link">Workflow Engine</a></li><li class="nav-list-item"><a href="/Core/Logging.html" class="nav-list-link">Logging</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in UI category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Core/UI/" class="nav-list-link">UI</a><ul class="nav-list"><li class="nav-list-item"><a href="/Core/UI/Overview.html" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="/Core/UI/Debug.html" class="nav-list-link">Debug Mode</a></li><li class="nav-list-item"><a href="/Core/UI/Logs.html" class="nav-list-link">Logs Page</a></li><li class="nav-list-item"><a href="/Core/UI/Troubleshooting.html" class="nav-list-link">Troubleshooting</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Advanced/" class="nav-list-link">Advanced</a><ul class="nav-list"><li class="nav-list-item"><a href="/Advanced/Advanced_Nodes.html" class="nav-list-link">Advanced Nodes</a></li><li class="nav-list-item"><a href="/Advanced/Extending_Logging.html" class="nav-list-link">Extending Logging System</a></li><li class="nav-list-item"><a href="/Advanced/Human_in_the_loop.html" class="nav-list-link">Human-in-the-Loop</a></li><li class="nav-list-item"><a href="/Advanced/Deployment.html" class="nav-list-link">Deploying Workflows</a></li><li class="nav-list-item"><a href="/Advanced/Event_Driven.html" class="nav-list-link">Event-Driven Workflows</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Concepts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Concepts/" class="nav-list-link">Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/Concepts/state_machines.html" class="nav-list-link">State Machines</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Grapheteria" aria-label="Search Grapheteria" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/grapheteria/grapheteria" class="site-button" target="_blank" rel="noopener noreferrer" > View GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/Advanced/">Advanced</a></li> <li class="breadcrumb-nav-list-item"><span>Human-in-the-Loop</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="human-in-the-loop-halting-and-resuming-workflows">Human-in-the-Loop: Halting and Resuming Workflows</h1> <h2 id="the-need-for-human-input">The Need for Human Input</h2> <p>In agentic workflows, we often need humans to validate, correct, or provide data that machines can’t determine. Like asking your GPS if you should take that questionable shortcut through what appears to be someone’s backyard - sometimes human judgment is irreplaceable.</p> <p>Our state machine provides a built-in mechanism for pausing execution, collecting human input, and seamlessly resuming - whether immediately or days later.</p> <h2 id="how-it-works-futures-and-states">How It Works: Futures and States</h2> <p>The system uses Python’s <code class="language-plaintext highlighter-rouge">asyncio.Future</code> objects to implement halting. When a node requests input:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">user_name</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">What</span><span class="sh">'</span><span class="s">s your name?</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Hello, </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s">!</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Behind the scenes:</p> <ol> <li>The workflow status changes to <code class="language-plaintext highlighter-rouge">WAITING_FOR_INPUT</code></li> <li>The current state is saved</li> <li>A future is created and awaited, pausing execution</li> <li>When input arrives, the future resolves and execution continues</li> </ol> <blockquote class="note"> <p>Same process resumption is quite tricky to get right. An await operation on the <code class="language-plaintext highlighter-rouge">asyncio.Future</code> object blocks python’s event loop, causing your workflow to become seemingly unresponsive. In reality, it is currently awaiting and this is intended behavior. To design a seamless system, use your workflow in tandem with a <a href="Deployment">server</a>. This way python switches between coroutines and you can provide inputs with ease.</p> </blockquote> <h2 id="resumption-behavior">Resumption Behavior</h2> <p>There are two ways execution can resume after requesting input:</p> <h3 id="same-process-resumption">Same-Process Resumption</h3> <p>If input arrives while the original process is still running:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># In your workflow node
</span><span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Enter data:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Continues from exactly here
</span></code></pre></div></div> <h3 id="cross-process-resumption">Cross-Process Resumption</h3> <p>If the workflow is stopped and later restarted:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First execution
</span><span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Enter data:</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># Halts here
</span>
<span class="c1"># Days later, workflow engine restarts
</span><span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Enter data:</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># Re-executes this line
</span><span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Then continues
</span></code></pre></div></div> <p class="highlight">⚠️ <strong>Important</strong>: Code before the <code class="language-plaintext highlighter-rouge">await</code> will execute twice in cross-process resumption. Avoid side effects before await points:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># BAD: Side effect before await
</span><span class="nf">send_notification</span><span class="p">()</span>  <span class="c1"># Will run twice if resumed cross-process
</span><span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Enter data:</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># GOOD: Side effect after await  
</span><span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Enter data:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">send_notification</span><span class="p">()</span>  <span class="c1"># Will only run once
</span></code></pre></div></div> <h2 id="request-input-parameters">Request Input Parameters</h2> <p>The <code class="language-plaintext highlighter-rouge">request_input</code> function accepts these parameters:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">,</span> <span class="n">request_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</code></pre></div></div> <ul> <li><code class="language-plaintext highlighter-rouge">prompt</code>: Text shown to the user (e.g., “What’s your name?”)</li> <li><code class="language-plaintext highlighter-rouge">options</code>: Available choices for selection inputs</li> <li><code class="language-plaintext highlighter-rouge">input_type</code>: Format of input (“text”, “select”, etc.)</li> <li><code class="language-plaintext highlighter-rouge">request_id</code>: Custom identifier for this specific input request</li> </ul> <p>The <code class="language-plaintext highlighter-rouge">request_id</code> is critical when a node has multiple input requests:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">name</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Name?</span><span class="sh">"</span><span class="p">,</span> <span class="n">request_id</span><span class="o">=</span><span class="sh">"</span><span class="s">name_field</span><span class="sh">"</span><span class="p">)</span>
<span class="n">age</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Age?</span><span class="sh">"</span><span class="p">,</span> <span class="n">request_id</span><span class="o">=</span><span class="sh">"</span><span class="s">age_field</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Without unique <code class="language-plaintext highlighter-rouge">request_id</code>s, the same input would satisfy both requests!</p> <h2 id="providing-input-data">Providing Input Data</h2> <p>To resume a workflow, provide input as a dictionary to either the <code class="language-plaintext highlighter-rouge">step()</code> or <code class="language-plaintext highlighter-rouge">run()</code> methods of the workflow engine:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># For inputs with default node IDs
</span><span class="n">input_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">TextInputNode_12345</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">User</span><span class="sh">'</span><span class="s">s response</span><span class="sh">"</span>
<span class="p">}</span>

<span class="c1"># For inputs with custom request IDs
</span><span class="n">input_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">name_field</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">age_field</span><span class="sh">"</span><span class="p">:</span> <span class="mi">30</span>
<span class="p">}</span>

<span class="c1"># Complex input data is also supported
</span><span class="n">input_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">form_response</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">preferences</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">pizza</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">hiking</span><span class="sh">"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Resume workflow with inputs
</span><span class="k">await</span> <span class="n">workflow</span><span class="p">.</span><span class="nf">step</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</code></pre></div></div> <blockquote class="note"> <p>The key in the dictionary must match either the node ID or the custom request ID. The respective value is the actual input data you wish to provide to the node.</p> </blockquote> <h2 id="input-consumption-behavior">Input Consumption Behavior</h2> <p>When a workflow is halted:</p> <ol> <li>You must call <code class="language-plaintext highlighter-rouge">workflow.step()</code> or <code class="language-plaintext highlighter-rouge">workflow.run()</code> with input data to resume</li> <li>Inputs are consumed when used and won’t persist for future requests</li> <li>If inputs are provided for the wrong halted node, the workflow remains halted</li> <li>Inputs provided in advance will be lost if not immediately used</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This will NOT work:
</span><span class="k">await</span> <span class="n">workflow</span><span class="p">.</span><span class="nf">step</span><span class="p">({</span><span class="sh">"</span><span class="s">future_node_id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">})</span>  <span class="c1"># Input for a node not yet halted
# ... later when the node halts ...
</span><span class="k">await</span> <span class="n">workflow</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>  <span class="c1"># The input is already gone!
</span></code></pre></div></div> <h2 id="example-of-an-agent-requiring-feedback">Example of an Agent Requiring Feedback</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ContentReviewNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">request_input</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="n">shared</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">draft_content</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">request_input</span><span class="sh">"</span><span class="p">:</span> <span class="n">request_input</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">llm_client</span><span class="sh">"</span><span class="p">:</span> <span class="n">shared</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm_client</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">async</span> <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prepared_data</span><span class="p">):</span>
        <span class="n">request_input</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="sh">"</span><span class="s">request_input</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">llm_client</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="sh">"</span><span class="s">llm_client</span><span class="sh">"</span><span class="p">]</span>
        
        <span class="c1"># First, get LLM suggestions
</span>        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Suggest improvements for this content:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">llm_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">llm_client</span><span class="p">.</span><span class="nf">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
        
        <span class="c1"># Show suggestions to human for approval
</span>        <span class="n">user_decision</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">The AI suggests these improvements. Accept?</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Accept All</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Accept Some</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Reject All</span><span class="sh">"</span><span class="p">],</span>
            <span class="n">input_type</span><span class="o">=</span><span class="sh">"</span><span class="s">select</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">request_id</span><span class="o">=</span><span class="sh">"</span><span class="s">improvement_decision</span><span class="sh">"</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">user_decision</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Accept Some</span><span class="sh">"</span><span class="p">:</span>
            <span class="c1"># Request specific edits from human
</span>            <span class="n">specific_edits</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span>
                <span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Which specific changes would you like to make?</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">request_id</span><span class="o">=</span><span class="sh">"</span><span class="s">specific_edits</span><span class="sh">"</span>
            <span class="p">)</span>
            
            <span class="c1"># Second LLM call with human guidance
</span>            <span class="n">refined_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Revise this content:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="se">\n\n</span><span class="s">With these specific changes: </span><span class="si">{</span><span class="n">specific_edits</span><span class="si">}</span><span class="sh">"</span>
            <span class="n">final_content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">llm_client</span><span class="p">.</span><span class="nf">generate</span><span class="p">(</span><span class="n">refined_prompt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">user_decision</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Accept All</span><span class="sh">"</span><span class="p">:</span>
            <span class="n">final_content</span> <span class="o">=</span> <span class="n">llm_response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_content</span> <span class="o">=</span> <span class="n">content</span>
            
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span> <span class="sh">"</span><span class="s">final</span><span class="sh">"</span><span class="p">:</span> <span class="n">final_content</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">prepared_data</span><span class="p">,</span> <span class="n">execution_result</span><span class="p">):</span>
        <span class="n">shared</span><span class="p">[</span><span class="sh">"</span><span class="s">reviewed_content</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_result</span><span class="p">[</span><span class="sh">"</span><span class="s">final</span><span class="sh">"</span><span class="p">]</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
