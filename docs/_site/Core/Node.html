<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(1)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(1) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(1) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Node | Grapheteria</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Node" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Cooking up agentic workflows!" /> <meta property="og:description" content="Cooking up agentic workflows!" /> <link rel="canonical" href="http://localhost:4000/Core/Node.html" /> <meta property="og:url" content="http://localhost:4000/Core/Node.html" /> <meta property="og:site_name" content="Grapheteria" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Node" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Cooking up agentic workflows!","headline":"Node","url":"http://localhost:4000/Core/Node.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Grapheteria </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Core/" class="nav-list-link">Core</a><ul class="nav-list"><li class="nav-list-item"><a href="/Core/Node.html" class="nav-list-link">Node</a></li><li class="nav-list-item"><a href="/Core/Edge.html" class="nav-list-link">Edge</a></li><li class="nav-list-item"><a href="/Core/Shared.html" class="nav-list-link">Communication</a></li><li class="nav-list-item"><a href="/Core/Workflow.html" class="nav-list-link">Workflow Engine</a></li><li class="nav-list-item"><a href="/Core/Logging.html" class="nav-list-link">Logging</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in UI category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Core/UI/" class="nav-list-link">UI</a><ul class="nav-list"><li class="nav-list-item"><a href="/Core/UI/Overview.html" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="/Core/UI/Debug.html" class="nav-list-link">Debug Mode</a></li><li class="nav-list-item"><a href="/Core/UI/Logs.html" class="nav-list-link">Logs Page</a></li><li class="nav-list-item"><a href="/Core/UI/Troubleshooting.html" class="nav-list-link">Troubleshooting</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Advanced/" class="nav-list-link">Advanced</a><ul class="nav-list"><li class="nav-list-item"><a href="/Advanced/Advanced_Nodes.html" class="nav-list-link">Advanced Nodes</a></li><li class="nav-list-item"><a href="/Advanced/Extending_Logging.html" class="nav-list-link">Extending Logging System</a></li><li class="nav-list-item"><a href="/Advanced/Human_in_the_loop.html" class="nav-list-link">Human-in-the-Loop</a></li><li class="nav-list-item"><a href="/Advanced/Deployment.html" class="nav-list-link">Deploying Workflows</a></li><li class="nav-list-item"><a href="/Advanced/Event_Driven.html" class="nav-list-link">Event-Driven Workflows</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Concepts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Concepts/" class="nav-list-link">Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/Concepts/state_machines.html" class="nav-list-link">State Machines</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Grapheteria" aria-label="Search Grapheteria" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/grapheteria/grapheteria" class="site-button" target="_blank" rel="noopener noreferrer" > View GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/Core/">Core</a></li> <li class="breadcrumb-nav-list-item"><span>Node</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="working-with-nodes">Working with Nodes</h1> <h2 id="overview">Overview</h2> <p>The Node class is the smallest unit of execution in Grapheteria’s workflow system - think of it as the atom in your workflow molecule. All task-performing classes must extend this class to join the party. Nodes handle individual pieces of work, process data, make decisions, or interact with external systems.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">grapheteria</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="k">class</span> <span class="nc">MyCustomNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prepared_result</span><span class="p">):</span>
        <span class="c1"># Your execution logic goes here
</span>        <span class="k">return</span> <span class="sh">"</span><span class="s">Hello, Grapheteria!</span><span class="sh">"</span>
</code></pre></div></div> <h2 id="the-triple-phase-model">The Triple-Phase Model</h2> <p>Grapheteria nodes follow a clear three-phase execution model inspired by <a href="https://github.com/The-Pocket/PocketFlow" target="_blank">PocketFlow</a>, bringing order to the potentially chaotic world of workflow execution. This separation creates clear boundaries for different responsibilities and improves maintainability.</p> <h3 id="1-prepare">1. Prepare</h3> <p>The prepare function sets the stage for execution. It receives two parameters:</p> <ul> <li><code class="language-plaintext highlighter-rouge">shared</code>: The shared state dictionary for cross-node communication</li> <li><code class="language-plaintext highlighter-rouge">request_input</code>: A function that can request for human input</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Use this function to read from shared, a db or pre-process data
</span><span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">request_input</span><span class="p">):</span>
    <span class="c1"># Extract what you need from shared state
</span>    <span class="n">name</span> <span class="o">=</span> <span class="n">shared</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">user_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">friend</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">initial_data</span> <span class="o">=</span> <span class="n">shared</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">,</span> <span class="p">{})</span>
    <span class="c1"># Return exactly what execute needs - nothing more, nothing less
</span>    <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="sh">"</span><span class="s">greeting</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Hello</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">initial_data</span><span class="p">}</span>
</code></pre></div></div> <h3 id="2-execute">2. Execute</h3> <p>The execute function is where the magic happens. It receives only one parameter:</p> <ul> <li><code class="language-plaintext highlighter-rouge">prepared_result</code>: The output from the prepare phase</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The main work happens here, using only what prepare provided. Call an API or perform computation.
</span><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prepared_result</span><span class="p">):</span>
    <span class="n">processed_data</span> <span class="o">=</span> <span class="nf">do_something_with</span><span class="p">(</span><span class="n">prepared_result</span><span class="p">[</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">prepared_result</span><span class="p">[</span><span class="sh">'</span><span class="s">greeting</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">prepared_result</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">!</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">processed_data</span><span class="sh">"</span><span class="p">:</span> <span class="n">processed_data</span>
    <span class="p">}</span>
</code></pre></div></div> <p>Notice how <code class="language-plaintext highlighter-rouge">execute</code> doesn’t receive the shared state directly. This is intentional! It:</p> <ol> <li>Prevents accidental corruption of shared state during critical operations</li> <li>Enables future parallel execution of multiple nodes (<a href="../Advanced/Advanced_Nodes">see Parallelism docs</a>)</li> <li>Forces clean separation of concerns between phases</li> </ol> <p>Execution comes with built-in resilience:</p> <ul> <li><code class="language-plaintext highlighter-rouge">max_retries</code>: Number of attempts before giving up (default: 1)</li> <li><code class="language-plaintext highlighter-rouge">wait</code>: Time to wait between retries in seconds</li> <li><code class="language-plaintext highlighter-rouge">exec_fallback</code>: Method called when all retries fail</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ReliableNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prepared_result</span><span class="p">):</span>
        <span class="c1"># Potentially flaky operation
</span>        <span class="k">await</span> <span class="nf">call_external_api</span><span class="p">()</span>
        <span class="k">return</span> 
        
    <span class="k">def</span> <span class="nf">exec_fallback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prepared_result</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="c1"># Handle the failure gracefully
</span>        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">reason</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">exception</span><span class="p">)}</span>

<span class="c1"># Create instance with retry parameters
</span><span class="n">reliable_node</span> <span class="o">=</span> <span class="nc">ReliableNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="sh">"</span><span class="s">reliable</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div> <h3 id="3-cleanup">3. Cleanup</h3> <p>The cleanup function handles post-execution tasks. It receives all three pieces of context:</p> <ul> <li><code class="language-plaintext highlighter-rouge">shared</code>: The shared state dictionary</li> <li><code class="language-plaintext highlighter-rouge">prepared_result</code>: The original output from prepare</li> <li><code class="language-plaintext highlighter-rouge">execution_result</code>: The output from execute</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Update shared state with our results or write results to a db
</span><span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">prepared_result</span><span class="p">,</span> <span class="n">execution_result</span><span class="p">):</span>
    <span class="n">shared</span><span class="p">[</span><span class="sh">"</span><span class="s">greeting_message</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_result</span><span class="p">[</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">shared</span><span class="p">[</span><span class="sh">"</span><span class="s">processed_data</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_result</span><span class="p">[</span><span class="sh">"</span><span class="s">processed_data</span><span class="sh">"</span><span class="p">]</span>
    <span class="c1"># write_to_db()
</span></code></pre></div></div> <h2 id="custom-node-ids">Custom Node IDs</h2> <p>Always define a custom ID for each node rather than relying on auto-generated IDs:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Good: Descriptive, unique ID
</span><span class="n">node</span> <span class="o">=</span> <span class="nc">MyCustomNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="sh">"</span><span class="s">validate_user_input_step</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Bad: Relying on auto-generated ID
</span><span class="n">node</span> <span class="o">=</span> <span class="nc">MyCustomNode</span><span class="p">()</span>  <span class="c1"># Gets something like "MyCustomNode_a1b2c3d4"
</span></code></pre></div></div> <p>Custom IDs are crucial for:</p> <ol> <li>Logging and debugging - imagine searching logs for “validate_user_input_step” vs “MyCustomNode_a1b2c3d4”</li> <li>Resuming workflows after interruption - when restarting a workflow, the system needs to know exactly which node to resume from</li> <li>Providing data to halted nodes requesting human input - when a node is waiting for input, you need a clear ID to send that input to the right place</li> </ol> <p>Without meaningful IDs, your workflow becomes a mysterious black box. With them, it transforms into a transparent, manageable, and resumable process.</p> <h2 id="node-configuration">Node Configuration</h2> <p>Nodes can be configured through a config dictionary passed during initialization. This enhances reusability - the same node class can be used for multiple purposes just by changing its configuration.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create two different LLM agents from the same class
</span><span class="n">customer_service</span> <span class="o">=</span> <span class="nc">LLMNode</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="sh">"</span><span class="s">customer_service</span><span class="sh">"</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">system_prompt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">You are a helpful customer service representative.</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="mi">500</span>
<span class="p">})</span>

<span class="n">creative_writer</span> <span class="o">=</span> <span class="nc">LLMNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="sh">"</span><span class="s">creative_writer</span><span class="sh">"</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">system_prompt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">You are a creative storyteller with a flair for drama.</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2000</span>
<span class="p">})</span>
</code></pre></div></div> <p>Access config values inside your node methods:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">request_input</span><span class="p">):</span>
    <span class="n">system_prompt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">system_prompt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Default system prompt</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">system_message</span><span class="sh">"</span><span class="p">:</span> <span class="n">system_prompt</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">prompt</span><span class="sh">"</span><span class="p">:</span> <span class="n">shared</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">user_message</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="n">temperature</span>
    <span class="p">}</span>
</code></pre></div></div> <h2 id="using-request_input">Using request_input</h2> <p>The <code class="language-plaintext highlighter-rouge">request_input</code> function allows nodes to request external input during execution - perfect for human-in-the-loop scenarios. The function can be called without any parameters, though additional information helps guide the user:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">request_input</span><span class="p">):</span>
    <span class="c1"># Simple confirmation prompt - with helpful parameters
</span>    <span class="n">user_choice</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Do you approve this transaction?</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Approve</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Reject</span><span class="sh">"</span><span class="p">],</span>
        <span class="n">input_type</span><span class="o">=</span><span class="sh">"</span><span class="s">select</span><span class="sh">"</span>
    <span class="p">)</span>
    
    <span class="c1"># If rejection, ask for reason in the same prepare phase
</span>    <span class="k">if</span> <span class="n">user_choice</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Reject</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">request_input</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="sh">"</span><span class="s">Please provide reason for rejection:</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">input_type</span><span class="o">=</span><span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">request_id</span><span class="o">=</span><span class="sh">"</span><span class="s">rejection_reason</span><span class="sh">"</span>  <span class="c1"># Different from default node ID
</span>        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">rejected</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">reason</span><span class="sh">"</span><span class="p">:</span> <span class="n">reason</span><span class="p">}</span>
    
    <span class="c1"># Store the choice for execute phase
</span>    <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">user_approved</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">request_id</code> parameter differentiates between multiple input requests within the same node. Without it, the same input would be reused for all calls (defaulting to the node’s ID). For a more informative lesson on <code class="language-plaintext highlighter-rouge">request_input()</code> please check out the <a href="../Advanced/Human_in_the_loop">Human-in-the-Loop</a> docs.</p> <h2 id="running-nodes-standalone">Running Nodes Standalone</h2> <p>For testing and debugging, you can run nodes independently without setting up an entire workflow:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">test_node</span><span class="p">():</span>
    <span class="c1"># Create initial shared state
</span>    <span class="n">shared_state</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">user_name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Grapheteria Fan</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">}}</span>
    
    <span class="c1"># Create and run the node
</span>    <span class="n">node</span> <span class="o">=</span> <span class="nc">ProcessingNode</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">processing_level</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">detailed</span><span class="sh">"</span><span class="p">})</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">node</span><span class="p">.</span><span class="nf">run_standalone</span><span class="p">(</span><span class="n">shared_state</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Updated shared state: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Processed data: </span><span class="si">{</span><span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">processed_data</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Run it
</span><span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">test_node</span><span class="p">())</span>
</code></pre></div></div> <p>Note that <code class="language-plaintext highlighter-rouge">request_input</code> functionality won’t work in standalone mode - it’s strictly for testing node logic without human interaction.</p> <h2 id="initializing-nodes-in-json-and-code">Initializing Nodes in JSON and Code</h2> <p>Grapheteria offers flexibility by letting you define workflows in both Python code and JSON. While your Node class implementation must be in Python, you can instantiate and connect nodes using either approach.</p> <h3 id="in-code-python">In Code (Python)</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a processing node with a custom ID and configuration
</span><span class="n">processor</span> <span class="o">=</span> <span class="nc">MyCustomNode</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="sh">"</span><span class="s">data_processor_1</span><span class="sh">"</span><span class="p">,</span> 
    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">max_items</span><span class="sh">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="sh">"</span><span class="s">verbose</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div> <h3 id="in-json">In JSON</h3> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"nodes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data_processor_1"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MyCustomNode"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"max_items"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nl">"verbose"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <blockquote class="note"> <p><strong>Why JSON?</strong> JSON workflows sync in real-time with the UI, letting devs design and modify workflows visually with an intuitive debugging experience.</p> </blockquote> <p>With these building blocks, you can create nodes that gracefully handle any workflow task your application needs!</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
